# MentalChat16K集成指南

## 📝 概述

将MentalChat16K数据集（68,228个文档）集成到现有的RAG心理咨询系统中。

---

## 🚀 三种集成方法

### 方法1：使用集成脚本（最简单）⭐⭐⭐⭐⭐

**步骤**：

```bash
# 1. 复制文件到项目根目录
cp integrate_mentalchat.py /path/to/your/project/

# 2. 运行脚本
cd /path/to/your/project
python integrate_mentalchat.py

# 3. 选择选项3（推荐）
```

**优点**：不需要修改代码，5分钟完成

---

### 方法2：修改RAGManager（推荐永久集成）⭐⭐⭐⭐

**步骤1**：修改 `knowledge/rag_manager.py`

在 `__init__` 方法末尾添加：

```python
class RAGManager:
    def __init__(self, config):
        # ... 现有代码 ...
        
        # 新增：自动加载MentalChat16K
        self._auto_load_mentalchat()
```

**步骤2**：添加加载方法（在同一文件的类末尾）

```python
def _auto_load_mentalchat(self):
    """自动加载MentalChat16K知识库"""
    import os
    from knowledge.data_loaders import DataLoader
    
    csv_path = 'data/datasets/MentalChat16K_train.csv'
    
    if not os.path.exists(csv_path):
        print("ℹ️  MentalChat16K数据集未找到")
        return
    
    print("\n自动加载MentalChat16K知识库...")
    
    try:
        loader = DataLoader(chunk_size=600, chunk_overlap=0)
        documents = loader.load_csv(csv_path)
        
        print(f"✅ 成功加载 {len(documents)} 个文档")
        
        # 添加到向量数据库
        for i, doc in enumerate(documents):
            self.psych_kb.add_document(
                content=doc.content,
                metadata=doc.metadata
            )
            
            if (i + 1) % 1000 == 0:
                print(f"  进度: {i+1}/{len(documents)}")
        
        print("✅ MentalChat16K知识库已加载")
        
    except Exception as e:
        print(f"⚠️  加载失败: {str(e)}")
```

**优点**：永久集成，每次启动自动加载

---

### 方法3：配置文件驱动

**步骤1**：更新 `configs/config.yaml`

```yaml
knowledge:
  sources:
    txt_directories:
      - data/sample_knowledge
    
    csv_files:
      - path: data/datasets/MentalChat16K_train.csv
        question_col: question
        answer_col: answer
        chunk_size: 600
```

**步骤2**：修改加载器读取配置

**优点**：灵活管理多个数据源

---

## 🔍 验证集成

### 测试1：数据加载

```bash
python -c "
from knowledge.data_loaders import DataLoader
loader = DataLoader()
docs = loader.load_csv('data/datasets/MentalChat16K_train.csv')
print(f'✅ 成功加载 {len(docs)} 个文档')
"
```

### 测试2：RAG检索

```bash
python test_integration.py
```

### 测试3：完整对话

```bash
python examples/basic_rag_chat.py
```

---

## 📊 集成前后对比

| 项目 | 集成前 | 集成后 |
|------|--------|--------|
| 文档数 | 54 | **68,282** |
| 提升 | - | **1265倍** |

---

## 🔧 常见问题

### Q1: 集成后系统变慢？

**解决方法**：

```python
# 方法1：减少检索文档数
result = rag_manager.retrieve(query, top_k=3)

# 方法2：批量添加文档
rag_manager.psych_kb.add_documents_batch(documents)
```

### Q2: 如何只加载部分数据？

```python
documents = loader.load_csv(
    'data/datasets/MentalChat16K_train.csv',
    nrows=1000  # 只加载前1000条
)
```

### Q3: 如何更新知识库？

```bash
# 删除旧数据
rm -rf data/chroma_db

# 重新运行集成
python integrate_mentalchat.py
```

---

## 📝 论文写作建议

### 数据集章节

> "本研究使用MentalChat16K数据集（16,084个问答对）构建RAG知识库。
> 采用与Mentalic Net相同的预处理方法：文本分块为600字符，过滤少于
> 50字符的短文本，最终获得68,228个知识库文档片段。"

### 实验对比

| 系统 | 数据集 | 知识库规模 |
|------|--------|-----------|
| Mentalic Net | MentalChat16K | ~6000 |
| 你的系统 | MentalChat16K | **68,228** |

**优势**：
- ✅ 相同数据集（可公平对比）
- ✅ 三层记忆系统（创新点）
- ✅ 21个评估指标

---

## 🎯 下一步

1. ✅ 验证集成效果
2. ✅ 运行评估实验
3. ✅ 完成对比实验
4. ✅ 撰写论文

---

祝你的论文顺利完成！🎓🚀
